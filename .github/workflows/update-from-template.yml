name: Update from Template

on:
  workflow_dispatch:
  schedule:
    # –ó–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é –≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 9:00 UTC
    - cron: '0 9 * * 1'

jobs:
  update-from-template:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: Configure Git
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
    
    - name: Add upstream remote
      run: |
        git remote add upstream https://github.com/GTFB/probo.git || true
    
    - name: Fetch upstream
      run: git fetch upstream
    
    - name: Check for updates
      id: check-updates
      run: |
        if git diff --quiet main upstream/main; then
          echo "no-updates=true" >> $GITHUB_OUTPUT
        else
          echo "no-updates=false" >> $GITHUB_OUTPUT
        fi
    
    - name: Create update branch
      if: steps.check-updates.outputs.no-updates == 'false'
      run: |
        git checkout -B update-from-template upstream/main
        git push origin update-from-template --force
    
    - name: Create Pull Request
      if: steps.check-updates.outputs.no-updates == 'false'
      uses: peter-evans/create-pull-request@v5
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        title: "üîÑ Update from template"
        body: |
          ## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —à–∞–±–ª–æ–Ω–∞ probo
          
          –≠—Ç–æ—Ç PR —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ —à–∞–±–ª–æ–Ω–∞ probo.
          
          ### –ò–∑–º–µ–Ω–µ–Ω–∏—è:
          - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ upstream/main
          - –î–∞—Ç–∞: ${{ github.run_date }}
          
          ### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
          - [ ] –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å —Ç–µ–∫—É—â–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º
          - [ ] –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º
          - [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ
          
          –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–∂–Ω–æ –º–µ—Ä–∂–∏—Ç—å —ç—Ç–æ—Ç PR –≤ main.
        head: update-from-template
        base: main
        delete-branch: false
        draft: false
    
    - name: No updates message
      if: steps.check-updates.outputs.no-updates == 'true'
      run: echo "‚úÖ –ù–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏–∑ —à–∞–±–ª–æ–Ω–∞"
