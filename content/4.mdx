---
title: "4. Технические требования"
icon: "Cpu"
prevButtonText: "К пользовательским сценариям"
nextButtonText: "К программным интерфейсам (API)"
---

### 4. Технические требования

Этот раздел определяет технологический стек, архитектурные принципы и нефункциональные требования, которые обеспечат производительность, масштабируемость и безопасность платформы.

#### 4.1. Технологический стек
Выбранный стек оптимизирован для скорости разработки (DX), производительности (Performance) и типизированной безопасности (Type Safety).

*   **Frontend:** Next.js, TypeScript, Tailwind CSS, Shadcn/ui, Zustand.
*   **Backend (Ядро):** Payload CMS, Node.js, TypeScript.
*   **Микросервисы:** Bun, ElysiaJS, TypeScript.
*   **База данных:** PostgreSQL с расширением `pgvector` для семантического поиска.
*   **Интеграции:** Stripe API, OpenAI API, Telegram Bot API, Google/Microsoft APIs (OAuth, SMTP/IMAP).
*   **Инструменты:** Docker, Zod (валидация), React Hook Form, ESLint, Prettier.


```mermaid
graph TD
    A[Технологический стек Influbalance] --> B[Frontend]
    A --> C[Backend]
    A --> D[Интеграции]
    A --> E[DevOps & Tooling]
    
    B --> B1[Framework</br>Next.js]
    B --> B2[Language</br>TypeScript]
    B --> B3[Styling</br>Tailwind CSS]
    B --> B4[Components</br>Shadcn/ui]
    
    C --> C1[Core</br>Payload CMS]
    C --> C2[Microservice</br>Bun / ElysiaJS]
    C --> C3[Database</br>PostgreSQL</br>pgvector]
    
    D --> D1[Stripe</br>Stripe API]
    D --> D2[OpenAI</br>OpenAI API]
    D --> D3[Google/MS</br>OAuth, SMTP/IMAP]
    D --> D4[Telegram</br>Telegram Bot API]
    
    E --> E1[Docker</br>Docker]
    E --> E2[GitHub</br>Actions]
    E --> E3[Coolify</br>Kubernetes]
```

#### 4.2. Архитектура

*   **Микросервисная архитектура:** Каждый ключевой бизнес-процесс (рассылка, AI-генерация, парсинг) вынесен в отдельный, независимый сервис. Это обеспечивает отказоустойчивость (падение одного сервиса не затронет остальные) и возможность независимого масштабирования.
*   **Мульти-тенантность (для White-Label):** Архитектура изначально проектируется с разделением данных по `tenant_id`. Все запросы к API и базе данных строго изолированы в рамках одного партнера, что является ключевым требованием для White-Label.
*   **Контейнеризация:** Все бэкенд-сервисы и база данных упаковываются в Docker-контейнеры. Это гарантирует идентичность окружений для разработки, тестирования и продакшена, исключая проблемы "у меня на машине все работало".


```mermaid
graph TD
    subgraph "Интернет"
        User[Клиент / Партнер]
    end

    User --> CDN[CDN / Vercel]
    CDN --> FE[Frontend: Next.js]

    subgraph "Kubernetes / Docker"
        LB[Load Balancer]
        subgraph "Backend Services"
            Core[Ядро API: Payload CMS]
            AI[AI Service]
            Outreach[Outreach Service]
            Parser[Parser Service]
        end
        DB[(PostgreSQL)]
    end

    FE -- "API Calls" --> LB
    LB --> Core
    Core -- "gRPC/REST" --> AI
    Core -- "gRPC/REST" --> Outreach
    Core -- "gRPC/REST" --> Parser
    Core -- "CRUD" --> DB
```

#### 4.3. Требования к производительности (нефункциональные)

*   **Время ответа API:** < 200 мс для 95% запросов (за исключением тяжелых AI-операций).
*   **Время загрузки клиентского портала (FCP - First Contentful Paint):** < 1.5 секунды.
*   **Масштабируемость:** Система должна быть способна обрабатывать до 100 одновременно запущенных кампаний, отправляя до 50 000 уникальных писем в сутки, с возможностью горизонтального масштабирования сервисов.

#### 4.4. Требования к безопасности

*   **Аутентификация и Авторизация:** JWT-токены для сессий. RBAC (Role-Based Access Control) на уровне API для разделения прав Клиента, Администратора и Партнера.
*   **Хранение данных:** Пароли пользователей хэшируются (bcrypt). Все внешние ключи API, токены и другие секреты хранятся в защищенном хранилище (например, Doppler, Vault или переменные окружения).
*   **Изоляция данных:** Жесткая фильтрация всех запросов к БД по `tenant_id` на уровне репозиториев данных, чтобы исключить любую возможность утечки данных между партнерами.
*   **Защита от веб-уязвимостей:** Валидация всех входящих данных на уровне API с помощью Zod для предотвращения инъекций. Применение стандартных практик защиты от XSS, CSRF.

#### 4.5. Инфраструктура и DevOps

*   **Хостинг:** Vercel для Frontend, кластер Kubernetes (GKE, EKS) или managed-сервисы (DigitalOcean Apps, Railway) для бэкенд-сервисов и БД.
*   **CI/CD:** Автоматизированные пайплайны на GitHub Actions для каждого пуша в основные ветки. Пайплайн включает: линтинг, запуск тестов, сборку Docker-образов и автоматический деплой на staging-окружение. Деплой на production - по ручному триггеру.


```mermaid
graph TD
    A(Разработчик делает 'git push') --> B[GitHub Actions];
    subgraph B
        B1[Lint & Format Check] --> B2[Unit & Integration Tests];
        B2 --> B3[Build Docker Image];
    end
    B3 --> C{Тесты прошли?};
    C -- Да --> D[Push образа в Docker Registry];
    D --> E[Авто-деплой на Staging];
    E --> F((Ручной деплой на Production));
    C -- Нет --> G((Сборка провалена. Уведомление в Telegram));
```
