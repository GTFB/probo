---
title: "2. Функциональные требования"
icon: "Component"
prevButtonText: "Введение и цели проекта"
nextButtonText: "К пользовательским сценариям"
---

### **2. Функциональные требования**

#### **2.1. Модули системы**
Система состоит из следующих логических модулей (микросервисов и приложений), которые взаимодействуют через API:
1.  **Клиентский портал (Frontend):** Веб-приложение на Next.js для взаимодействия с клиентами.
2.  **Панель Администратора (Admin Panel):** Интерфейс на базе Payload CMS для управления всеми аспектами системы.
3.  **Ядро API (Core API):** API на базе Payload, предоставляющее доступ к данным и являющееся центральным хабом.
4.  **Сервис подбора и генерации (AI Service):** Микросервис для подбора инфлюенсеров и генерации текстов.
5.  **Сервис рассылок (Outreach Service):** Микросервис, отвечающий за отправку email-цепочек и трекинг ответов.
6.  **Сервис парсинга (Parser Service):** Микросервис для сбора и обновления базы инфлюенсеров.
7.  **Сервис уведомлений (Notification Service):** Микросервис для отправки real-time уведомлений в мессенджеры.

##### **Диаграмма компонентов (C5 - Level 2)**
```mermaid
graph TD
    subgraph "Юзер-интерфейсы"
        A["Клиентский портал"]
        B["Панель Администратора"]
    end

    subgraph "Бэкенд-система"
        C["Ядро API (Payload CMS)"]
        D["AI Service"]
        E["Outreach Service"]
        F["Parser Service"]
        G["Notification Service"]
    end

    A -- REST/GraphQL --> C
    B -- REST/GraphQL --> C
    C -- "Оркестрация" --> D
    C -- "Оркестрация" --> E
    C -- "Оркестрация" --> F
    C -- "Оркестрация" --> G
```

#### **2.2. Роли пользователей**
*   **Клиент:**
    *   Просмотр главной страницы, кейсов, тарифов.
    *   Регистрация и аутентификация.
    *   Создание и оплата Проекта через квиз-форму.
    *   Просмотр статуса своего Проекта в личном кабинете.
    *   Получение уведомлений о позитивных ответах.
*   **Администратор (Команда Антона):**
    *   Полный CRUD-доступ ко всем сущностям: Клиенты, Проекты, Инфлюенсеры, Кампании.
    *   Просмотр системной аналитики и дашбордов.
    *   Ручной запуск/остановка Кампаний.
    *   Управление базой шаблонов для AI-генерации.
    *   Управление Тенантами (партнерами).
*   **Партнер (Тенант):**
    *   Доступ к кастомизированной (White-Label) версии Панели Администратора.
    *   Управляет только своими Клиентами и Проектами.
    *   Просматривает аналитику только в рамках своего тенанта.

##### **Карта ролей и их ключевых прав**
```mermaid
graph TD
    Root["Роли пользователей"]
    
    Root --> Client["Клиент"]
    Root --> Admin["Администратор"]
    Root --> Partner["Партнер (Тенант)"]
    
    Client --> C1["Создание/оплата Проекта"]
    Client --> C2["Просмотр статуса"]
    Client --> C3["Получение результатов"]
    
    Admin --> A1["Полное управление системой (CRUD)"]
    Admin --> A2["Просмотр глобальной аналитики"]
    Admin --> A3["Управление Партнерами"]
    
    Partner --> P1["Управление своими Клиентами"]
    Partner --> P2["Просмотр своей аналитики"]
    Partner --> P3["Изолированный доступ"]
```

#### **2.3. Функциональные возможности по модулям**

**2.3.1. Клиентский портал**
*   **Онбординг:** Многошаговый квиз для сбора данных о Проекте.
*   **Оплата:** Интеграция со Stripe для приема депозитов за пакеты ответов.
*   **Личный кабинет:** Дашборд с ключевыми метриками Проекта (Цель / Текущий результат), список полученных позитивных ответов.

**2.3.2. Панель Администратора**
*   Управление инфлюенсерами: импорт, редактирование, просмотр истории контактов.
*   Управление проектами: просмотр всех активных проектов, редактирование критериев, ручная модерация.
*   Аналитика: дашборд с общей эффективностью платформы (конверсии, среднее время на закрытие проекта и т.д.).

**2.3.3. Сервис подбора и генерации (AI Service)**
*   API-эндпоинт для подбора инфлюенсеров: принимает критерии Проекта, возвращает список ID релевантных инфлюенсеров из БД.
*   API-эндпоинт для генерации текстов: принимает данные о продукте клиента и профиле инфлюенсера, возвращает готовую цепочку из 3 персонализированных писем.

**2.3.4. Сервис рассылок (Outreach Service)**
*   Подключение почтовых ящиков (Google, Microsoft) по SMTP/IMAP.
*   Автоматическое управление "прогревом" ящиков.
*   Запуск, постановка на паузу и остановка email-кампаний.
*   Трекинг ответов через IMAP.
*   AI-классификация ответов (Позитивный / Нейтральный / Негативный).
*   Автоматическая остановка цепочки после получения ответа.

**2.3.5. Сервис уведомлений (Notification Service)**
*   Интеграция с Telegram Bot API.
*   Отправка уведомлений клиенту и администратору при получении позитивного ответа.
*   Отправка сводных отчетов о статусе кампании.

##### **Последовательность обработки нового проекта (Sequence Diagram)**
```mermaid
sequenceDiagram
    participant Client as Клиент
    participant Portal as Клиентский Портал
    participant Core as Ядро API
    participant AI as AI Service
    participant Outreach as Outreach Service

    Client->>Portal: 1. Заполняет и отправляет квиз
    Portal->>Core: 2. Создать Проект (данные квиза, статус "Оплачен")
    Core->>AI: 3. Подобрать инфлюенсеров (критерии Проекта)
    AI-->>Core: 4. Возвращает список ID инфлюенсеров
    Core->>AI: 5. Сгенерировать тексты (данные Проекта + список ID)
    AI-->>Core: 6. Возвращает готовые email-цепочки
    Core->>Outreach: 7. Запустить Кампанию (цепочки + цели)
    Outreach-->>Core: 8. Подтверждение запуска
```
